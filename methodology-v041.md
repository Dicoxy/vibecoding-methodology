# Методология вайбкодинга v0.4.1

## Блочная архитектура: от лендингов к масштабируемым проектам

*Версия 0.4.1 | Февраль 2026*
*Эволюция: блочная архитектура, контракты, оркестрация агентов*

---

## Что нового в v0.4

```
v0.3.1  Лендинги, правило изменений, поблочные правки
  │
  ▼
v0.4.0  Блочная архитектура
        ├── Контракты входа/выхода для каждого блока
        ├── Автовалидация на стыках
        ├── Обход лимита контекстного окна
        ├── Параллельное исполнение блоков
        └── Масштаб: от лендинга до сложного проекта
```

### Зачем

Контекстное окно ИИ — ограничено. Даже 200K токенов деградируют после ~130K.
Блочная архитектура решает это: каждый блок помещается в одну сессию ИИ,
а связь между блоками — через типизированные контракты, а не через
"помни что было раньше".

---

## Ключевая идея

**Принцип:** Вход блока B валидирует выход блока A.
Если данные не соответствуют контракту → ошибка локализована в блоке A.

---

## Тиры проектов

```
Tier 1: Лендинг .................. 3-5 блоков ......... методология v0.3.1
Tier 2: Многостраничный сайт ..... 8-15 блоков ........ методология v0.4
Tier 3: Веб-приложение ........... 15-40 блоков ....... методология v0.4+
Tier 4: Сложная система .......... 40+ блоков ......... будущее
```

v0.4 фокусируется на **Tier 2-3**. Tier 1 продолжает работать по v0.3.1.

---

## Участники процесса

```
┌─────────────────────────────────────────────────────────────────────┐
│                       ЧЕЛОВЕК-АРХИТЕКТОР                            │
│          Декомпозиция, контракты, приёмка, бизнес-решения          │
└──────────────────────────┬──────────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    ИИ-ОРКЕСТРАТОР                                    │
│          Claude Chat / будущий скрипт                               │
│          Граф блоков, контракты, раздача задач, проверка стыков     │
└──────┬──────────┬──────────┬──────────┬──────────┬──────────────────┘
       │          │          │          │          │
       ▼          ▼          ▼          ▼          ▼
  ┌─────────┐┌─────────┐┌─────────┐┌─────────┐┌─────────┐
  │ Агент 1 ││ Агент 2 ││ Агент 3 ││ Агент 4 ││ Агент N │
  │Claude   ││Cline    ││Cursor   ││Claude   ││  ...    │
  │Code     ││+DeepSeek││         ││Code     ││         │
  │ Кодер → ││ Кодер → ││ Кодер → ││ Кодер → ││ Кодер → │
  │ Ревью → ││ Ревью → ││ Ревью → ││ Ревью → ││ Ревью → │
  │(Фоллбэк)││(Фоллбэк)││(Фоллбэк)││(Фоллбэк)││(Фоллбэк)│
  └─────────┘└─────────┘└─────────┘└─────────┘└─────────┘
       │          │          │          │          │
       ▼          ▼          ▼          ▼          ▼
    Блок A     Блок B     Блок C     Блок D     Блок E
```

**Три уровня:**
1. **Человек-архитектор** — бизнес-решения, утверждение контрактов
2. **ИИ-оркестратор** — планирование, контракты, проверка стыков (НЕ кодит)
3. **Агенты-исполнители** — код, тесты, коммиты (НЕ планируют)

---

## Что такое Блок

Блок — это самодостаточная единица кода, которую можно:
- Написать за одну сессию ИИ (< 30K токенов контекста)
- Протестировать изолированно
- Заменить, не трогая остальное

### Анатомия блока

```
block-name/
├── SPEC.md              ← ЧТО делает блок (контракт)
├── src/                 ← КАК реализован
│   └── ...
├── tests/               ← Проверка контракта
│   └── ...
├── CONTRACT.md          ← Вход/выход (типы, формат, ограничения)
└── CHANGELOG.md         ← История изменений
```

### CONTRACT.md — формат

```
# Контракт: [Название блока]

## Вход (Input)
- Тип: [описание типа данных]
- Формат: [JSON / Props / файлы / API endpoint]
- Обязательные поля: [список]
- Валидация: [правила]

## Выход (Output)
- Тип: [описание]
- Формат: [React компонент / API response / файл]
- Гарантии: [что всегда true на выходе]

## Зависимости
- Блоки-поставщики: [от кого получает данные]
- Блоки-потребители: [кому отдаёт результат]

## Инварианты (всегда должно быть true)
- Рендерится без ошибок при пустых данных
- Мобильная версия не ломает десктоп
- Не влияет на соседние блоки
```

---

## Типы блоков

### Для веб-проектов

| Тип блока | Размер | Пример | Контракт |
|-----------|--------|--------|----------|
| **UI-компонент** | 50-200 строк | Button, Card, Modal | Props → JSX |
| **Секция страницы** | 100-500 строк | HeroSection, ProductGrid | Data + Config → Section |
| **Страница** | Сборка секций | /products, /about | Route + Data → Page |
| **Сервис** | 100-300 строк | API client, Auth | Request → Response |
| **Утилита** | 20-100 строк | formatPrice, validateEmail | Input → Output (pure) |
| **Конфигурация** | 50-150 строк | Tailwind config, routes | Schema → Config object |

### Правило размера

```
Блок > 500 строк → декомпозировать
Блок 50-300 строк → идеально для одной сессии ИИ
Блок < 20 строк → возможно, слишком мелко (объединить)
```

---

## Фазы проекта (v0.4)

```
Фаза 0: Подготовка ............... Человек .............. 1-2 часа
Фаза 1: Спецификация ............. Claude Chat .......... 1-2 часа
Фаза 2: Декомпозиция на блоки .... Claude Chat + Человек  1-2 часа
Фаза 3: Дизайн ................... Дизайнер / Claude Chat 2-5 дней
Фаза 4: Согласование ............. Человек + Заказчик ... 1-3 дня
Фаза 5: Реализация блоков ........ Claude Code .......... 4-8 часов
Фаза 6: Сборка и интеграция ...... Claude Code .......... 1-2 часа
Фаза 7: Валидация ................ Автотесты + Человек .. 1-2 часа
Фаза 8: Деплой ................... Claude Chat + MCP .... 1 час
                                                          Итого: 12-25ч
                                                          Календарно: 5-14 дней
```

---

## Фаза 1: Спецификация

**Кто:** Claude Chat + Человек | **Время:** 1-2 часа

Создаём главную спецификацию проекта — единый источник правды:
цель, аудитория, структура страниц, визуальный стиль, тех. стек,
бизнес-логика, ограничения.

✅ Спецификация утверждена человеком. Без этого — не продолжаем.

---

## Фаза 2: Декомпозиция на блоки

**Кто:** Claude Chat + Человек | **Время:** 1-2 часа

Разбиваем проект на блоки. Для каждого блока — CONTRACT.md.

### Результат: Граф блоков по слоям

```
Слой 0 (без зависимостей — делаем первыми):
├── config/theme, config/routes, utils/formatters, types/models

Слой 1 (зависит от Слоя 0):
├── ui/Button, ui/Card, ui/Form, ui/Navigation, ui/Footer

Слой 2 (зависит от Слоя 0-1):
├── sections/Hero, sections/ProductGrid, sections/About, services/api

Слой 3 (зависит от Слоя 0-2):
├── pages/Home, pages/Products, pages/About, pages/Contacts

Слой 4 (финальная сборка):
└── app/layout
```

### Правила декомпозиции

1. Блоки одного слоя НЕ зависят друг от друга → можно делать параллельно
2. Блок зависит ТОЛЬКО от блоков нижних слоёв → нет циклов
3. Каждый блок <= 300 строк → помещается в контекст
4. Каждый блок имеет CONTRACT.md → стыки проверяемы

✅ Граф блоков утверждён. Контракты записаны. Без этого — не кодим.

---

## Фаза 5: Реализация блоков

**Кто:** Claude Code | **Время:** 4-8 часов

### Ключевое правило

ОДНА СЕССИЯ = ОДИН БЛОК

Контекст сессии содержит:
1. CLAUDE.md (общий контекст)
2. CONTRACT.md текущего блока
3. CONTRACT.md зависимых блоков (только контракты, не код!)
4. Дизайн/мокап текущего блока

Если нужно больше — блок слишком большой. Декомпозируй.

### Порядок: строго по слоям, снизу вверх

После каждого блока: тесты + коммит + валидация контракта.

### Обработка ошибок на стыках

```
Ошибка на стыке A → B:
├── Проверить: выход A соответствует контракту?
│   ├── Нет → починить блок A (новая сессия)
│   └── Да → проверить вход B
│       ├── Нет → починить блок B (новая сессия)
│       └── Да → проблема в контракте → обновить CONTRACT.md
```

Ошибка всегда локализована. Не нужно перечитывать весь проект.

---

## Оркестрация агентов

### Ключевой принцип: оркестратор НЕ кодит

Оркестратор определяет КАКИЕ данные должны входить и выходить из каждого блока.
Он не знает КАК это реализовано внутри. Его задача — правильная линейка блоков
и правильные типы данных на стыках.

### Динамическое расширение

Если выход блока B не совместим со входом блока C, оркестратор добавляет
блок-адаптер B-C между ними. Как API Gateway в микросервисах.

---

## Внутренняя архитектура агента-исполнителя

Каждый агент — мини-пайплайн:

```
КОДЕР (дешёвая модель: DeepSeek V3)
  │ код готов
  ▼
РЕВЬЮЕР (средняя модель: Claude Sonnet)
  ├── PASS → коммит, отдать оркестратору
  ├── MINOR → вернуть кодеру с правками
  └── FAIL → эскалация на фоллбэк
        │
        ▼
ФОЛЛБЭК (дорогая модель: Claude Opus, thinking mode)
  Подключается ТОЛЬКО при аварии.
  95% блоков решаются на уровне кодер+ревьюер.
```

### Экономика моделей

```
Роль         Модель              Цена/1M токенов   Когда
Оркестратор  Claude Opus/Sonnet  $3-15 input       Один раз на проект
Кодер        DeepSeek V3         $0.27 input       Каждый блок
Ревьюер      Claude Sonnet       $3 input          Каждый блок
Фоллбэк      Claude Opus         $15 input         5% блоков (аварии)
```

### Пример: Tier 2 проект (12 блоков)

```
Оркестрация: ~$0.05
Кодеры (12 блоков): ~$0.02
Ревьюеры (12 блоков): ~$0.30
Аварии (1 из 12): ~$0.25
ИТОГО: ~$0.62
```

---

## Рабочий прототип (февраль 2026)

```
Оркестратор:   Claude Chat (claude.ai, ручной режим)
               Генерит SPEC.md, BLOCKS.md, contracts/*

Агент 1:       Claude Code (терминал 1)
Агент 2:       Cline в VS Code (терминал 2)
Агент 3:       Cursor Composer (терминал 3)

Каждый агент получает:
- CLAUDE.md + CONTRACT.md своего блока + контракты зависимостей + дизайн

Человек: переключается между терминалами, проверяет, мёржит в git
```

### Git-стратегия для параллельных агентов

```
main
├── block/config-theme      (агент 1) → merge
├── block/config-routes     (агент 2) → merge
├── block/types-models      (агент 3) → merge
│   [Слой 0 замёржен]
├── block/ui-button         (агент 1) → merge
├── block/ui-card           (агент 2) → merge
├── block/ui-form           (агент 3) → merge
│   [Слой 1 замёржен]
└── ...
```

Блоки одного слоя работают в разных файлах → конфликтов почти нет.

---

## Путь к полной автоматизации

### Уровень 1: Ручной (сейчас)
Человек = оркестратор + диспетчер + мёржер. 2-3 агента параллельно.
Скорость: x1.5-2 от одиночного режима.

### Уровень 2: Полуавтоматический (2026 Q2-Q3)
Python-скрипт: читает BLOCKS.md, запускает агентов через API,
проверяет контракты, собирает результаты. Человек только утверждает.
Скорость: x3-5.

### Уровень 3: Автоматический (2026 Q4 — 2027)
Полноценный ИИ-оркестратор: принимает SPEC.md → выдаёт готовый проект.
Сам декомпозирует, сам запускает агентов, сам проверяет стыки,
сам добавляет адаптеры. Человек только бизнес-решения.
Скорость: x10-20.

---

## Правила (обновлённые)

### Из v0.3.1 (сохраняются)
- Улучшаем существующее — НЕ переписываем
- Escape-контроль
- Коммиты как чекпоинты
- Batch-задачи с проверкой

### Новые в v0.4

**Правило контекста:** Одна сессия ИИ = один блок + его контракты.
Никогда не загружай весь проект. Если нужно больше — блок слишком большой.

**Правило локализации ошибок:** Ошибка в блоке B? Проверь вход (данные от A).
Невалидный → проблема в A. Валидный → проблема в B.
Никогда не ищи ошибку "по всему проекту".

**Правило параллельности:** Блоки одного слоя не зависят друг от друга.
Можно делать параллельно разными агентами/людьми/сессиями.

---

## Сравнение с индустрией

| Аспект | Наша методология | GitHub Spec Kit | AWS Kiro |
|--------|-----------------|-----------------|----------|
| Спецификация | SPEC.md + CONTRACT.md | spec.md + plan.md | requirements.md + design.md |
| Блоки | Явные, с контрактами | Неявные (tasks) | tasks.md |
| Валидация стыков | Автоматическая (цель) | Чеклист (ручная) | Чеклист (ручная) |
| Обход контекста | Одна сессия = один блок | Не решается | Не решается |
| Параллельность | Слои → параллельно | Нет | Нет |
| Оркестрация | ИИ-оркестратор + агенты | Нет (один агент) | Нет (один агент) |
| Экономика моделей | Дешёвый кодер + дорогой ревью | Одна модель | Одна модель |
| Динамическое расширение | Блоки-адаптеры | Нет | Нет |

---

## Метрики успеха

| Метрика | Tier 1 | Tier 2 | Tier 3 |
|---------|--------|--------|--------|
| Себестоимость | < $50 | < $150 | < $500 |
| Время работы | 8-15ч | 15-25ч | 25-50ч |
| Календарно | 3-7 дн | 5-14 дн | 10-30 дн |
| PageSpeed | > 80 | > 80 | > 75 |
| Регрессий | 0 | 0 | 0 |
| Блоков | 3-5 | 8-15 | 15-40 |
| Покрытие контрактами | - | 100% | 100% |

---

## Дорожная карта

### v0.4.0 ✅
- [x] Блочная архитектура, CONTRACT.md, послойная реализация

### v0.4.1 ✅ (текущая)
- [x] Оркестрация агентов, экономика моделей, прототип

### v0.4.2 (следующий)
- [ ] Обкатка на реальном Tier 2 проекте
- [ ] Шаблон CONTRACT.md (автогенерация)
- [ ] Скрипт валидации контрактов
- [ ] Замер реальной экономики по моделям

### v0.5.0
- [ ] Python-скрипт оркестратор
- [ ] Запуск агентов через API
- [ ] Автопроверка контрактов
- [ ] Дашборд статуса

### v0.6.0
- [ ] Полная автоматизация: SPEC.md → готовый проект
- [ ] Динамические блоки-адаптеры
- [ ] 5-10 параллельных агентов
- [ ] Автороутинг моделей

---

*Версия 0.4.1 | Февраль 2026*
*Обратная совместимость: Tier 1 работает по v0.3.1*
